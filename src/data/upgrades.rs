#[derive(Debug, Clone)]
pub struct UpgradeDef {
    pub id: &'static str,
    pub name: &'static str,
    pub description: &'static str,
    pub max_level: u32,
    pub base_cost: u64,
    pub cost_scaling: f64,
    pub category: UpgradeCategory,
}

#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum UpgradeCategory {
    Speed,
    Luck,
    Wealth,
    Mastery,
    Discovery,
    Unlock,
}

impl UpgradeCategory {
    pub fn label(self) -> &'static str {
        match self {
            UpgradeCategory::Speed => "Speed",
            UpgradeCategory::Luck => "Luck",
            UpgradeCategory::Wealth => "Wealth",
            UpgradeCategory::Mastery => "Mastery",
            UpgradeCategory::Discovery => "Discovery",
            UpgradeCategory::Unlock => "Unlock",
        }
    }
}

impl UpgradeDef {
    pub fn cost_at_level(&self, level: u32) -> u64 {
        (self.base_cost as f64 * self.cost_scaling.powi(level as i32)) as u64
    }
}

pub fn all_upgrades() -> Vec<UpgradeDef> {
    vec![
        // === Unlock (6) ===
        UpgradeDef {
            id: "iron_key",
            name: "Iron Key",
            description: "Unlock Iron chests (requires level 5)",
            max_level: 1,
            base_cost: 100,
            cost_scaling: 1.0,
            category: UpgradeCategory::Unlock,
        },
        UpgradeDef {
            id: "silver_key",
            name: "Silver Key",
            description: "Unlock Silver chests (requires level 10)",
            max_level: 1,
            base_cost: 500,
            cost_scaling: 1.0,
            category: UpgradeCategory::Unlock,
        },
        UpgradeDef {
            id: "gold_key",
            name: "Gold Key",
            description: "Unlock Gold chests (requires level 20)",
            max_level: 1,
            base_cost: 5000,
            cost_scaling: 1.0,
            category: UpgradeCategory::Unlock,
        },
        UpgradeDef {
            id: "crystal_key",
            name: "Crystal Key",
            description: "Unlock Crystal chests (requires level 30)",
            max_level: 1,
            base_cost: 50000,
            cost_scaling: 1.0,
            category: UpgradeCategory::Unlock,
        },
        UpgradeDef {
            id: "shadow_key",
            name: "Shadow Key",
            description: "Unlock Shadow chests (requires level 40)",
            max_level: 1,
            base_cost: 500000,
            cost_scaling: 1.0,
            category: UpgradeCategory::Unlock,
        },
        UpgradeDef {
            id: "void_key",
            name: "Void Key",
            description: "Unlock Void chests (requires level 50)",
            max_level: 1,
            base_cost: 5000000,
            cost_scaling: 1.0,
            category: UpgradeCategory::Unlock,
        },
        // === Speed (7) ===
        UpgradeDef {
            id: "swift_hands",
            name: "Swift Hands",
            description: "+10% chest speed per level",
            max_level: 10,
            base_cost: 50,
            cost_scaling: 1.5,
            category: UpgradeCategory::Speed,
        },
        UpgradeDef {
            id: "nimble_fingers",
            name: "Nimble Fingers",
            description: "+5% chest speed per level",
            max_level: 20,
            base_cost: 30,
            cost_scaling: 1.3,
            category: UpgradeCategory::Speed,
        },
        UpgradeDef {
            id: "overdrive",
            name: "Overdrive",
            description: "+15% chest speed per level",
            max_level: 5,
            base_cost: 500,
            cost_scaling: 2.0,
            category: UpgradeCategory::Speed,
        },
        UpgradeDef {
            id: "perpetual_gear",
            name: "Perpetual Gear",
            description: "+10% chest speed per level",
            max_level: 10,
            base_cost: 300,
            cost_scaling: 1.6,
            category: UpgradeCategory::Speed,
        },
        UpgradeDef {
            id: "quicksilver_touch",
            name: "Quicksilver Touch",
            description: "+8% chest speed per level",
            max_level: 15,
            base_cost: 200,
            cost_scaling: 1.5,
            category: UpgradeCategory::Speed,
        },
        UpgradeDef {
            id: "haste_rune",
            name: "Haste Rune",
            description: "+20% chest speed per level",
            max_level: 3,
            base_cost: 2000,
            cost_scaling: 2.5,
            category: UpgradeCategory::Speed,
        },
        UpgradeDef {
            id: "chrono_accelerator",
            name: "Chrono Accelerator",
            description: "+12% chest speed per level",
            max_level: 8,
            base_cost: 800,
            cost_scaling: 1.8,
            category: UpgradeCategory::Speed,
        },
        // === Luck (8) ===
        UpgradeDef {
            id: "lucky_charm",
            name: "Lucky Charm",
            description: "+1 luck per level",
            max_level: 15,
            base_cost: 40,
            cost_scaling: 1.4,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "four_leaf",
            name: "Four-Leaf Clover",
            description: "+2 luck per level",
            max_level: 10,
            base_cost: 100,
            cost_scaling: 1.6,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "critical_eye",
            name: "Critical Eye",
            description: "+2% crit chance per level",
            max_level: 10,
            base_cost: 80,
            cost_scaling: 1.5,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "fortune_wheel",
            name: "Fortune Wheel",
            description: "+3 luck per level",
            max_level: 8,
            base_cost: 250,
            cost_scaling: 1.7,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "horseshoe",
            name: "Horseshoe",
            description: "+1% rarity upgrade chance per level",
            max_level: 5,
            base_cost: 400,
            cost_scaling: 2.0,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "rabbits_paw",
            name: "Rabbit's Paw",
            description: "+4 luck per level",
            max_level: 5,
            base_cost: 600,
            cost_scaling: 2.0,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "lucky_dice",
            name: "Lucky Dice",
            description: "+3% crit chance per level",
            max_level: 5,
            base_cost: 500,
            cost_scaling: 2.0,
            category: UpgradeCategory::Luck,
        },
        UpgradeDef {
            id: "stars_alignment",
            name: "Star's Alignment",
            description: "+5 luck per level",
            max_level: 3,
            base_cost: 2500,
            cost_scaling: 2.5,
            category: UpgradeCategory::Luck,
        },
        // === Wealth (8) ===
        UpgradeDef {
            id: "gold_touch",
            name: "Gold Touch",
            description: "+10% GP multiplier per level",
            max_level: 15,
            base_cost: 60,
            cost_scaling: 1.4,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "xp_boost",
            name: "XP Boost",
            description: "+10% XP multiplier per level",
            max_level: 15,
            base_cost: 60,
            cost_scaling: 1.4,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "treasure_sense",
            name: "Treasure Sense",
            description: "+20% GP multiplier per level",
            max_level: 10,
            base_cost: 200,
            cost_scaling: 1.7,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "golden_magnet",
            name: "Golden Magnet",
            description: "+15% GP per level",
            max_level: 10,
            base_cost: 350,
            cost_scaling: 1.6,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "wisdom_tome",
            name: "Wisdom Tome",
            description: "+15% XP per level",
            max_level: 10,
            base_cost: 350,
            cost_scaling: 1.6,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "alchemist_stone",
            name: "Alchemist's Stone",
            description: "+25% GP per level",
            max_level: 5,
            base_cost: 1000,
            cost_scaling: 2.0,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "scholars_cap",
            name: "Scholar's Cap",
            description: "+25% XP per level",
            max_level: 5,
            base_cost: 1000,
            cost_scaling: 2.0,
            category: UpgradeCategory::Wealth,
        },
        UpgradeDef {
            id: "dragon_hoard_map",
            name: "Dragon Hoard Map",
            description: "+30% GP per level",
            max_level: 3,
            base_cost: 3000,
            cost_scaling: 2.5,
            category: UpgradeCategory::Wealth,
        },
        // === Mastery (8) ===
        UpgradeDef {
            id: "keen_edge",
            name: "Keen Edge",
            description: "+3% crit chance per level",
            max_level: 5,
            base_cost: 600,
            cost_scaling: 2.0,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "crit_power",
            name: "Crit Power",
            description: "+0.2x crit multiplier per level",
            max_level: 10,
            base_cost: 400,
            cost_scaling: 1.8,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "combo_counter",
            name: "Combo Counter",
            description: "+5% GP per consecutive crit per level",
            max_level: 5,
            base_cost: 800,
            cost_scaling: 2.2,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "xp_amplifier",
            name: "XP Amplifier",
            description: "+20% XP per level",
            max_level: 5,
            base_cost: 500,
            cost_scaling: 2.0,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "legendary_focus",
            name: "Legendary Focus",
            description: "+10% legendary item GP per level",
            max_level: 10,
            base_cost: 700,
            cost_scaling: 1.9,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "executioners_edge",
            name: "Executioner's Edge",
            description: "+0.3x crit multiplier per level",
            max_level: 5,
            base_cost: 1500,
            cost_scaling: 2.2,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "precision_mastery",
            name: "Precision Mastery",
            description: "+4% crit chance per level",
            max_level: 3,
            base_cost: 2000,
            cost_scaling: 2.5,
            category: UpgradeCategory::Mastery,
        },
        UpgradeDef {
            id: "knowledge_nexus",
            name: "Knowledge Nexus",
            description: "+30% XP per level",
            max_level: 3,
            base_cost: 2500,
            cost_scaling: 2.5,
            category: UpgradeCategory::Mastery,
        },
        // === Discovery (8) ===
        UpgradeDef {
            id: "relic_magnet",
            name: "Relic Magnet",
            description: "+5% relic drop chance per level",
            max_level: 5,
            base_cost: 1000,
            cost_scaling: 2.5,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "deep_pockets",
            name: "Deep Pockets",
            description: "+1 relic slot per level",
            max_level: 2,
            base_cost: 5000,
            cost_scaling: 3.0,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "bonus_loot",
            name: "Bonus Loot",
            description: "+3% multi-drop chance per level",
            max_level: 5,
            base_cost: 600,
            cost_scaling: 2.0,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "chest_radar",
            name: "Chest Radar",
            description: "+10% chance for bonus chest drops per level",
            max_level: 5,
            base_cost: 800,
            cost_scaling: 2.0,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "void_sight",
            name: "Void Sight",
            description: "+15% rare+ item chance per level",
            max_level: 5,
            base_cost: 1200,
            cost_scaling: 2.2,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "treasure_hunter",
            name: "Treasure Hunter",
            description: "+8% relic drop chance per level",
            max_level: 3,
            base_cost: 3000,
            cost_scaling: 2.5,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "lucky_find",
            name: "Lucky Find",
            description: "+5% multi-drop chance per level",
            max_level: 3,
            base_cost: 2000,
            cost_scaling: 2.3,
            category: UpgradeCategory::Discovery,
        },
        UpgradeDef {
            id: "artifact_sense",
            name: "Artifact Sense",
            description: "+10% relic drop chance per level",
            max_level: 2,
            base_cost: 5000,
            cost_scaling: 3.0,
            category: UpgradeCategory::Discovery,
        },
    ]
}

pub fn get_upgrade(id: &str) -> Option<&'static UpgradeDef> {
    use std::sync::LazyLock;
    static UPGRADES: LazyLock<Vec<UpgradeDef>> = LazyLock::new(all_upgrades);
    UPGRADES.iter().find(|u| u.id == id)
}
